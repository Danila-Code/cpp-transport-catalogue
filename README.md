# Транспортный справочник
Учебный проект в Яндекс.Практикуме

## Описание
Справочник хранит информацию об остановках и транспортных маршрутах (автобусных). Заполнение справочника и получение информации о маршрутах реализовано с помощью JSON-запросов.

## Технологии:
* C++
* STL
* JSON
* XML
* SVG
* RAII
* динамический полиморфизм
* умные указатели
* ООП
* наследование
* алгоритмы на графах
* CMake

## В транспртном справочнике реализованы:
* класс для хранения транспортной информации TransportCatalogue
* класс для поиска наикратчайшего пути Router
* класс для представления остановок и маршрутов в виде графа зависимостей Graph
* отдельная библиотека для чтения JSON документа из потока и записи в поток (json.h, json.cpp)
* класс Builder для конструирования JSON документа, который выявляет ошибки построения на этапе компиляции
* класс JsonReader для заполнения справочника и формирования JSON ответов на запросы 
* отдельная библиотека для формирования строки с SVG графикой в формате XML (svg.h, svg.cpp)
* класс для отрисовки маршрутов MapRenderer с помощью SVG библиотеки
* класс RequestHandler для управлением остальными классами (TransportCatalogue, Router, MapRenderer), представляющий фасад справочника

## Будущие изменения:
* графический интерфейс
* сериализация транспортной информации

## Особенности транспортного справочника:
* программа разбита на модули-классы, каждый из которых выполняет свои функции
* заполнение справочника и выдача транспортной информации осуществляется с помощью JSON-запросов
* эффективное хранение транспортной информации в контейнере std::deque, который не инвалидируется при изменении размеров
* для быстрого поиска остановок и маршрутов по названию используются "легковесные" std::unordered_map'ы с указателями
* заполнение матрицы с наиболее короткими маршрутами происходит заранее в конструкторе класса Router 
* поиск наикратчайшего маршрута реализован с помощью алгоритма Дейкстры

## Запуск проекта
1. Скачайте файлы из текущего репозитория.
2. Создайте в корневой папке проекта папку "release" для сборки проекта, перейдите в неё в командной строке и запустите cmake:\
	`cmake ../ -DCMAKE_BUILD_TYPE=Release`\
**если работаете с MinGw, укажите дополнительный параметр -G "MinGW Makefiles".* 
7. Запустите сборку проекта в командной строке:\
	`cmake --build .`\
*Проект собран.*
8. Чтобы работать с транспортным справочником нужно в командной строке (находясь в папке "release" проекта) набрать:\
	`./transport-catalogue.exe <"входной файл запросов JSON" >"выходной файл ответов"`

## Системные требования
Компилятор С++, С++20, CMake 3.8

---
## Формат входного файла
Входной файл имеет формата JSON со следующей структурой:
```
{
  "base_requests": [ ... ],
  "render_settings": { ... },
  "routing_settings": { ... },
  "stat_requests": [ ... ]
}
``` 
где:\
`base_requests` - массив для заполнения справочника, который содержит описание транспортных маршрутов (автобусов) и остановок;\
`render_settings` - словарь с параметрами рендеринга карты маршрутов;\
`routing_settings` - словарь, в котором содержатся параметры движения транспорта;\
`stat_requests` - массив, который содержит запросы к справочнику.

---
### Структура base_requests
---
#### Описание транспортного маршрута:  
```
{
  "type": "Bus",
  "name": "1",
  "stops": [
    "Девяткино",
    "Гражданский проспект",
    "Академическая",
    "Политехническая"
  ],
  "is_roundtrip": true
} 
```
где:\
`type` - тип запроса, для автобуса равен "Bus";\
`name` - название маршрута;\
`stops` - массив с названиями остановок маршрута;\
`is_roundtrip` - значение типа bool, указывает кольцевой маршрут или нет.

---
#### Описание остановки:  
```
{
  "type": "Stop",
  "name": "Владимирская",
  "latitude": 60.402222,
  "longitude": 30.547778,
  "road_distances": {
    "Маяковская": 1000,
    "Садовая": 2100
  }
} 
```
где:\
`type` - тип запроса, для остановки равен "Stop";\
`name` - название остановки;\
`latitude` и `longitude` - координаты остановки (широта и долгота соответственно);\
`road_distances` - словарь, в котором указываются расстояния до соседних остановок в формате - "название остановки": расстояние в метрах.

---
### Структура render_settings:
```
{
  "width": 1000.0,
  "height": 1000.0,

  "padding": 50.0,

  "line_width": 10.0,
  "stop_radius": 4.0,

  "bus_label_font_size": 20,
  "bus_label_offset": [7.0, 14.0],

  "stop_label_font_size": 12,
  "stop_label_offset": [7.0, -4.0],

  "underlayer_color": [255, 255, 255, 0.85],
  "underlayer_width": 3.0,

  "color_palette": [
    "purple"
    [255, 0, 0],
  ]
} 
```
где:\
`width` и `height` - ширина и высота изображения в пикселях;\
`padding` - отступ от края SVG-документа;\
`line_width` - толщина линий, которыми рисуются автобусные маршруты;\
`stop_radius` - радиус окружностей, которыми обозначаются остановки;\
`bus_label_font_size` - размер текста названия автобусного маршрута;\
`bus_label_offset` - смещение текста названия маршрута относительно координат конечных остановок, задаётся в виде массива `dx` и `dy`;\
`stop_label_font_size` - размер текста названия остановки;\
`stop_label_offset` - смещение названия остановки относительно её координат на карте, задаётся в виде массива `dx` и `dy`;\
`underlayer_color` - цвет подложки под названиями остановок и маршрутов;\
`underlayer_width` - толщина подложки под названиями остановок и маршрутов;\
`color_palette` - цветовая палитра для обозначения маршрутов. Непустой массив.\
Цвет задаётся разными способами:
- строкой, например, "purple";
- в виде массива из трёх целых чисел от 0 до 255 (каждое число описывает соответствующую компоненту цвета RGB формата);
- в виде массива из четырёх целых чисел формат RGBA - четвёртое число в диапазоне от 0.0 до 1.0 обозначает прозрачность.

---
### Структура routing_settings
```
"routing_settings": {
      "bus_wait_time": 5,
      "bus_velocity": 60
} 
```
где:\
`bus_wait_time` - время ожидания автобуса на остановке, единое для всего справочника, в минутах;\
`bus_velocity` - средняя скорость автобуса, единое для всего справочника, в км/ч.

---
### Структура stat_requests
---
#### Запрос информации о транспортном маршруте или остановке:
```
{
  "id": 16756,
  "type": "Bus",
  "name": "1"
} 
```
где:\
`id` - уникальный номер запроса;\
'type' - тип запроса, для автобуса равен "Bus", для отановки - "Stop";\
`name` - название маршрута, о котором будет выведена информация (для автобуса - номер, для остановки - название, например "Маяковская").

---
#### Запрос изображения карты маршрута:
```
{
  "type": "Map",
  "id": 5475678
}
```
где:\
`id` - уникальный номер запроса;\
`type` - тип запроса, для построения карты равен "Map".

---
### Запрос построения кратчайшего маршрута между двумя остановками
```
{
      "id": 246436
      "type": "Route",
      "from": "Парнас",
      "to": "Ладожская"
}
```
где:\
`id` - уникальный номер запроса;\
'type' - тип запроса, для нахождения маршрута равен "Route";\
`from` — название начальной остановки;\
`to` — название конечной остановки.\
Остановки from и to должны находиться в базе справочника.

---
## Формат выходного файла
Программа выдаёт ответы на запросы в виде JSON-файла.

---
### Ответ на запрос информации о маршруте
```
{
  "curvature": 1.365,
  "request_id": 576,
  "route_length": 5600,
  "stop_count": 6,
  "unique_stop_count": 5
} 
```
где:\
`curvature` - отношению фактической длины маршрута (по дорогам) к прямолинейным географическому расстоянию, то есть извилистость;\
`request_id` - уникальный идентификатор запроса, соответствует id запроса "Bus" в stat_requests входного файла;\
`route_length` - длина маршрута, в м;\
`stop_count` - количество остановок в маршруте;\
`unique_stop_count` - количество уникальных остановок в маршруте (транспорт может проходить по одной и той же остановке несколько раз).

---
### Ответ на запрос информации об отановке
```
{
  "buses": [
      "430", "17"
  ],
  "request_id": 43656
} 
```
где:\
`buses` - массив с названиями маршрутов, которые проходят через остановку;\
`request_id` - уникальный идентификатор запроса, соответствует id запроса "Stop" в stat_requests входного файла.

---
### Ответ на запрос изображения маршрутов
```
{
  "map": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n
          <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">...\n</svg>",
  "request_id": 3435
} 
```
где:\
`map` - строка с изображением в формате SVG;\
`request_id` - уникальный идентификатор запроса, соответствует id запроса "Map" в stat_requests входного файла.\
Пример карты маршрутов в формате SVG:

---
### Ответ на запрос кратчайшего маршрута между двумя остановками
В ответе перечислен порядок проезда на различных автобусах, ожидание на остановках: 
```
{
          "items": [
              {
                  "stop_name": "Горьковская",
                  "time": 4,
                  "type": "Wait"
              },
              {
                  "bus": "2",
                  "span_count": 2,
                  "time": 7.18,
                  "type": "Bus"
              },
              {
                  "stop_name": "Сенная",
                  "time": 4,
                  "type": "Wait"
              },
              {
                  "bus": "5",
                  "span_count": 1,
                  "time": 2.41,
                  "type": "Bus"
              }
          ],
          "request_id": 5457,
          "total_time": 17.59
      }
 ```
где:\
`type` - тип действия, "Wait" - ожидание транспорта на остановке, "Bus" - проезд на транспорте;\
`span_count` - количество остановок;\
`time` - затрачиваемое время, в мин;\
`request_id` - уникальный идентификатор запроса, соответствует id запроса "Route" в stat_requests входного файла;\
`total_time` - суммарное время в пути, в мин.
